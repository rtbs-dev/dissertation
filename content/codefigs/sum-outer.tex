
\tikzset{matrixlayer/.style={
	matrix of math nodes,nodes in empty cells,
    nodes={minimum size=10mm,anchor=center,text=black,font=\small},
    column sep=-.5*\pgflinewidth,
    row sep=-.5*\pgflinewidth
}}
\begin{tikzpicture}[every node/.style={anchor=north east,fill=none,minimum width=1.7cm,minimum height=7mm},ampersand replacement=\&]

\node [draw,matrixlayer,style={fill=white}] (mA) 
{
|[fill=gray]|x_{m,1}x_{m,1} \& x_{m,1}x_{m,2}  \& |[fill=gray]|x_{m,1}x_{m,3} \& |[fill=gray]|x_{m,1}x_{m,4} \\
x_{m,2}x_{m,1} \& x_{m,2}x_{m,2}  \& x_{m,2}x_{m,3} \& x_{m,2}x_{m,4} \\
|[fill=gray]|x_{m,3}x_{m,1} \& x_{m,3}x_{m,2}  \& |[fill=gray]|x_{m,3}x_{m,3} \& |[fill=gray]|x_{m,3}x_{m,4} \\
|[fill=gray]|x_{m,4}x_{m,1} \& x_{m,4}x_{m,2}  \& |[fill=gray]|x_{m,4}x_{m,3} \& |[fill=gray]|x_{m,4}x_{m,4} \\
};

\node [draw,matrixlayer,style={fill=white}] (mB) at ($(mA.south west)+(2,2)$)
{
x_{i,1}x_{i,1} \& x_{i,1}x_{i,2}  \& x_{i,1}x_{i,3} \& x_{i,1}x_{i,4} \\
x_{i,2}x_{i,1} \& |[fill=gray]|x_{i,2}x_{i,2}  \& x_{i,2}x_{i,3} \& x_{i,2}x_{i,4} \\
x_{i,3}x_{i,1} \& x_{i,3}x_{i,2}  \& x_{i,3}x_{i,3} \& x_{i,3}x_{i,4} \\
x_{i,4}x_{i,1} \& x_{i,4}x_{i,2}  \& x_{i,4}x_{i,3} \& x_{i,4}x_{i,4} \\
};

\node [draw,matrixlayer,style={fill=white}] (mC) at ($(mB.south west)+(2,2)$)
{
|[fill=gray]|x_{1,1}x_{1,1} \& x_{1,1}x_{1,2}  \& |[fill=gray]|x_{1,1}x_{1,3} \& x_{1,1}x_{1,4} \\
x_{1,2}x_{1,1} \& x_{1,2}x_{1,2}  \& x_{1,2}x_{1,3} \& x_{1,2}x_{1,4} \\
|[fill=gray]|x_{1,3}x_{1,1} \& x_{1,3}x_{1,2}  \& |[fill=gray]|x_{1,3}x_{1,3} \& x_{1,3}x_{1,4} \\
x_{1,4}x_{1,1} \& x_{1,4}x_{1,2}  \& x_{1,4}x_{1,3} \& x_{1,4}x_{1,4} \\
};

\draw[dashed](mA.north east)--(mC.north east);
\draw[dashed](mA.north west)-- node[sloped,above] {sum over observations $i\in \{1,\cdots m\}$} (mC.north west);
\draw[dashed](mA.south east)--(mC.south east);

\node [above left] at (mC.north) {$X(i,j')$};
\node [left] at (mC.west) {$X(i,j)$};

\node [below right] at (mC.south) {$\mathbf{x}_1=[1,0,1,0]$};
\node [below right] at (mB.south) {$\mathbf{x}_i=[0,1,0,0]$};
\node [below right] at (mA.south) {$\mathbf{x}_m=[1,0,1,1]$};

\node [right] at ($(mB.east)+(1,-3)$) {$G(j,j')=\sum_{i=1}^m\mathbf{x}_i\mathbf{x}_i^T$};
\end{tikzpicture}
